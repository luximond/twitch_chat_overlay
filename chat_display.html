<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Custom Twitch Chat Overlay</title>
<style>
    body {
        margin: 0;
        padding: 10px;
        background: transparent;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: white;
        overflow: hidden;
    }
    
    #chat-container {
        width: 350px;
        height: 800px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
    }
    
    .message {
        margin-bottom: 5px;
        padding: 5px 8px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 4px;
        font-size: 14px;
        line-height: 1.4;
        animation: slideIn 0.3s ease-out;
    }
    
    .username {
        font-weight: bold;
        margin-right: 8px;
    }
    
    .message-text {
        word-wrap: break-word;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    #connection-status {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 5px 10px;
        background: rgba(255, 0, 0, 0.8);
        border-radius: 15px;
        font-size: 12px;
    }
    
    #connection-status.connected {
        background: rgba(0, 255, 0, 0.8);
    }
</style>
</head>
<body>
    <div id="connection-status">Connecting...</div>
    <div id="chat-container"></div>

    <script>
        class TwitchChat {
            constructor(channel) {
                this.channel = channel;
                this.socket = null;
                this.chatContainer = document.getElementById('chat-container');
                this.statusEl = document.getElementById('connection-status');
                this.maxMessages = 50; // Keep only last 50 messages
                this.connect();
            }

            connect() {
                this.socket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');
                
                this.socket.onopen = () => {
                    console.log('Connected to Twitch IRC');
                    // Authenticate as anonymous user
                    this.socket.send('PASS SCHMOOPIIE');
                    this.socket.send('NICK justinfan12345');
                    this.socket.send(`JOIN #${this.channel}`);
                    this.updateStatus('Connected', true);
                };

                this.socket.onmessage = (event) => {
                    this.handleMessage(event.data);
                };

                this.socket.onclose = () => {
                    console.log('Disconnected from Twitch IRC');
                    this.updateStatus('Disconnected', false);
                    // Reconnect after 5 seconds
                    setTimeout(() => this.connect(), 5000);
                };

                this.socket.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.updateStatus('Error', false);
                };
            }

            handleMessage(data) {
                const lines = data.split('\r\n');
                
                for (const line of lines) {
                    if (line.startsWith('PING')) {
                        this.socket.send('PONG :tmi.twitch.tv');
                    } else if (line.includes('PRIVMSG')) {
                        this.parsePrivMsg(line);
                    }
                }
            }

            parsePrivMsg(line) {
                const match = line.match(/:(\w+)!\w+@\w+\.tmi\.twitch\.tv PRIVMSG #\w+ :(.+)/);
                if (match) {
                    const [, username, message] = match;
                    this.addMessage(username, message);
                }
            }

            addMessage(username, message) {
                const messageEl = document.createElement('div');
                messageEl.className = 'message';
                
                const usernameEl = document.createElement('span');
                usernameEl.className = 'username';
                usernameEl.textContent = username;
                usernameEl.style.color = this.getUserColor(username);
                
                const messageTextEl = document.createElement('span');
                messageTextEl.className = 'message-text';
                messageTextEl.textContent = message;
                
                messageEl.appendChild(usernameEl);
                messageEl.appendChild(messageTextEl);
                
                this.chatContainer.appendChild(messageEl);
                
                // Remove old messages
                while (this.chatContainer.children.length > this.maxMessages) {
                    this.chatContainer.removeChild(this.chatContainer.firstChild);
                }
                
                // Auto-scroll
                messageEl.scrollIntoView({ behavior: 'smooth' });
            }

            getUserColor(username) {
                const colors = [
                    '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', 
                    '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD',
                    '#00D2D3', '#FF9F43', '#54A0FF', '#2ED573'
                ];
                
                let hash = 0;
                for (let i = 0; i < username.length; i++) {
                    hash = username.charCodeAt(i) + ((hash << 5) - hash);
                }
                
                return colors[Math.abs(hash) % colors.length];
            }

            updateStatus(text, connected) {
                this.statusEl.textContent = text;
                this.statusEl.className = connected ? 'connected' : '';
            }
        }

        // Initialize chat - replace 'yukibloo' with your actual channel name
        const chat = new TwitchChat('yukibloo');
    </script>
</body>
</html>
